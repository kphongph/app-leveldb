<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-request.html">

<script src="../dexie/dist/dexie.js"></script>

<script>
(function() {
  'use strict';
  Polymer.AppLevelDBDatabaseBehavior = {
    properties: {
      dbName: {
        type:String
      },
      schema: {
        type:Object
      },
      db:{
        type:Object,
        computed: '__computeDb(dbName,schema)',
        notify:true,
      }
    },
    save:function(data) {
     var self = this;
     return new Promise(function(fulfill,reject) {
       self.db.documents.get(data.value).then(function(obj) {
         if(!obj) {
           reject({key:data.value});
         } else {
           fulfill(obj);
         }
       });
     });
    },
    put:function(obj) {
     this.db.tables.forEach(function(table) {
       table.put(obj);
     });
    },
    __computeDb:function(dbName,schema) {
      if(!dbName) {
        return null;
      }
      var _db = new Dexie(dbName);
      schema['documents'] = 'key';
      _db.version(1).stores(schema);
      return _db;
    }
  };
})();   
  
</script>
