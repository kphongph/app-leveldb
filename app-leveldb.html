<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-ajax/iron-request.html">
<link rel="import" href="./app-leveldb-database-behavior.html">

<!--
`app-leveldb`

@demo demo/index.html 
-->

<dom-module id="app-leveldb">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>Hello </h2>

    <iron-ajax id="syncAjax"
      method="POST"
      url$="{{dbLocation}}/api/query/{{dbName}}/{{viewName}}"
      params$='{"apikey":"{{apiKey}}"}'
      body="{{query}}"
      content-type="application/json"
      on-response="_handleSyncAjax"
      handle-as="json">
    </iron-ajax>
  </template>

  <script>
    Polymer({

      is: 'app-leveldb',

      behaviors: [
        Polymer.AppLevelDBDatabaseBehavior
      ],

      properties: {
        query:Object,
      },
      observers:[
        '_listDb(db)'
      ],
      _listDb:function(db) {
        this.$.syncAjax.generateRequest();
      },
      _handleSyncAjax:function(e) { 
        console.log(e.detail.response);
        var _this = this;
        e.detail.response.forEach(function(item) {
          _this.saveIndex(item);
        });
      }
      
    });
  </script>
</dom-module>
