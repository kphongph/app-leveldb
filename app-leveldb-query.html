<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="./app-leveldb-database-behavior.html">

<dom-module id="app-leveldb-query">

<template>

  <iron-ajax id="ajax"
    method="POST"
    url$="{{dbLocation}}/api/query/{{dbName}}/{{viewName}}"
    params$='{"apikey":"{{apiKey}}"}'
    body="{{query}}"
    content-type="application/json"
    handle-as="json">
  </iron-ajax>

</template>

<script>
(function() {
  'use strict';
  Polymer({
    is:'app-leveldb-query',
    behaviors: [
      Polymer.AppLevelDBDatabaseBehavior
    ],
    properties : {
      query: {
        type:Object
      },
      viewName:String,
      apiKey:String,
      data: {
        type:Array,
        readOnly:true,
        notify:true,
        value:function() {
          return [];
        }
      }
    },
    observers: [
      'refresh(query)' 
    ],
    refresh:function() {
      console.log('refresh');
      this.$.ajax.generateRequest();
    }
  });
})();
</script>
</dom-module>
